---
keycloak_ver: '9.0.0'
keycloak_mirror: https://downloads.jboss.org/keycloak

keycloak_parent_install_dir: /opt
keycloak_home: "{{ keycloak_parent_install_dir }}/keycloak"

keycloak_java_packages: openjdk-11-jre

keycloak_admin_username: admin

keycloak_log_dir: "/var/log/keycloak"

postgresql_driver_jar_mirror: https://jdbc.postgresql.org/download/
postgresql_driver_jar_name: postgresql-42.2.12.jre6
keycloak_postgresql_user: "keycloak"

# Certbot
keycloak_certbot_site_names: ["{{ keycloak_site_name }}"]
keycloak_certbot_mail_address: ""

# NGINX
keycloak_nginx_ssl_src_dir: "/etc/letsencrypt/live/{{ keycloak_site_name }}"
keycloak_nginx_ssl_cert_file: "fullchain.pem"
keycloak_nginx_ssl_key_file: "privkey.pem"
keycloak_nginx_certs_from_letsencrypt: true

keycloak_nginx_http_site: "{{ keycloak_site_name }}-http"
keycloak_nginx_https_site: "{{ keycloak_site_name }}-https"

keycloak_nginx_server_names_hash_bucket_size: 64
keycloak_nginx_sites:
  - server:
      name: "{{ keycloak_nginx_http_site }}"
      __listen: "80;\n  listen [::]:80;\n"
      server_name: "{{ keycloak_site_name }}"
      return: "301 https://$server_name$request_uri"
      ssl:
        enabled: false

  - server:
      name:  "{{ keycloak_nginx_https_site }}"
      __listen: "443;\n  listen [::]:443;\n"
      server_name: "{{ keycloak_site_name }}"
      client_max_body_size: "{{ keycloak_nginx_max_filesize }}"
      large_client_header_buffers: "8 64k"
      ssl:
        enabled: true
        cert: "{{ keycloak_nginx_ssl_cert_file }}"
        key:  "{{ keycloak_nginx_ssl_key_file }}"
        src_dir: "{{ keycloak_nginx_ssl_src_dir }}"
        conf: "{{ keycloak_site_name }}-ssl.conf"
        remote_src: "{{ keycloak_nginx_certs_from_letsencrypt }}"
        create_symlink: "{{ keycloak_nginx_certs_from_letsencrypt }}"
        access_log_format: "timed_combined"

      location1:
        name: "/"
        proxy_pass: "https://localhost:{{ keycloak_https_port }}"
        proxy_read_timeout: "86400s"
        proxy_next_upstream: "error timeout invalid_header http_502 http_503 http_504"
        proxy_set_header:
          - Host $host
          - X-Real-IP $remote_addr
          - X-Forwarded-For $proxy_add_x_forwarded_for
          - X-Forwarded-Host $server_name
          - X-Forwarded-Proto https
          
keycloak_nginx_log_dir: "/var/log/nginx"
keycloak_nginx_enabled_sites:
  - "{{ keycloak_nginx_http_site }}"
  - "{{ keycloak_nginx_https_site }}"
keycloak_nginx_disabled_sites:
  - default
keycloak_nginx_access_logs:
  - name: "timed_combined"
    format: "'$http_x_forwarded_for - $remote_user [$time_local]  \"$request\" $status $body_bytes_sent \"$http_referer\" \"$http_user_agent\" $request_time $upstream_response_time $gzip_ratio' $request_length"
    options: null
    filename: "access.log"

# Cheksums
keycloak_checksums:
  # https://downloads.jboss.org/keycloak/3.2.1.Final/keycloak-3.2.1.Final.tar.gz.sha1
  '3.2.1.Final': sha1:de6d7ac62e2a82c7ecdfcf04c9970163415d9b75
  # https://downloads.jboss.org/keycloak/3.4.3.Final/keycloak-3.4.3.Final.tar.gz.sha1
  '3.4.3.Final': sha1:f2b1272ab8d4413f408b444bc2108740845bc976
  # https://downloads.jboss.org/keycloak/4.4.0.Final/keycloak-4.4.0.Final.tar.gz.sha1
  '4.4.0.Final': sha1:5a1cf11f69862ff6944267a4e5509e9afaedddcb
  # https://downloads.jboss.org/keycloak/4.6.0.Final/keycloak-4.6.0.Final.tar.gz.sha1
  '4.6.0.Final': sha1:1dadc90860ec429a35e6e50b5ac4f4b6a7511dcc
  # https://downloads.jboss.org/keycloak/4.7.0.Final/keycloak-4.7.0.Final.tar.gz.sha1
  '4.7.0.Final': sha1:abb81b88ab762d58cb9d9c20948649265acfc356
  # https://downloads.jboss.org/keycloak/4.8.3.Final/keycloak-4.8.3.Final.tar.gz.sha1
  '4.8.3.Final': sha1:16abcbeb6a76f46a985eff66d69a326ca9a64a54
  # https://downloads.jboss.org/keycloak/5.0.0/keycloak-5.0.0.tar.gz.sha1
  '5.0.0': sha1:45848b55c36c8df3cbfeb156c7e4a71b61c4674a
  # https://downloads.jboss.org/keycloak/6.0.1/keycloak-6.0.1.tar.gz.sha1
  '6.0.1': sha1:472b37ccc9b5bb3119295c2880db49aada2fe9ed
  # https://downloads.jboss.org/keycloak/7.0.0/keycloak-7.0.0.tar.gz.sha1
  '7.0.0': sha1:0b55ca857682928968efaf64b75dbe0c16b7644c
  # https://downloads.jboss.org/keycloak/7.0.1/keycloak-7.0.1.tar.gz.sha1
  '7.0.1': sha1:eb2213cf652c08a61a756e32343a138e13a31c95
  # https://downloads.jboss.org/keycloak/8.0.0/keycloak-8.0.0.tar.gz.sha1
  '8.0.0': sha1:c08d2fffa5a054eb47d1833aadf95a1d3e09df9f
  # https://downloads.jboss.org/keycloak/8.0.1/keycloak-8.0.1.tar.gz.sha1
  '8.0.1': sha1:ca4d73cdba3b8ccea6777b0edbbe6bfafcc29a00
  # https://downloads.jboss.org/keycloak/9.0.0/keycloak-9.0.0.tar.gz.sha1
  '9.0.0': sha1:a667600d9e849a13e14e1bcb3b9821e28ce4ae9c
